var gatya_title =[
 ['戦え！ロイヤルメイド隊2nd','小型',[
        {item:'ダイドー',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'ビロクシ',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'グロスター',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'ハルゼー・パウエル',k_rare:'R',weight:5,k_bikou:'先'}
    ]],
 ['翳りし満ちる影の華','大型',[
        {item:'龍鳳',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'駿河',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'能代',k_rare:'SSR',weight:0.5,k_bikou:'先/交'},
        {item:'鬼怒',k_rare:'SR',weight:0.7,k_bikou:'先/交'},
        {item:'霞',k_rare:'SR',weight:2.5,k_bikou:'先'}
    ]],	
 ['幻想と真実の二重奏','大型',[
        {item:'ときのそら',k_rare:'SSR',weight:0.5,k_bikou:'交/？'},
        {item:'白上フブキ',k_rare:'SSR',weight:2,k_bikou:'？'},
        {item:'湊あくあ',k_rare:'SSR',weight:2,k_bikou:'？'},
        {item:'夏色まつり',k_rare:'SR',weight:2.5,k_bikou:'？'},
        {item:'百鬼あやめ',k_rare:'SR',weight:2.5,k_bikou:'？'}
    ]],
 ['激奏のポラリス','大型',[
        {item:'赤城(μ兵装)',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'ガスコーニュ(μ兵装)',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'クリーブランド(μ兵装)',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'アドミラル・ヒッパー(μ兵装)',k_rare:'SR',weight:2.5,k_bikou:'先'}
    ]],
 ['悲歎せし焔海の詩','大型',[
        {item:'ザラ',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'フォーミダブル',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'リットリオ',k_rare:'SSR',weight:0.5,k_bikou:'先/交'},
        {item:'ジュリオ・チェザーレ',k_rare:'SR',weight:2.5,k_bikou:'先'}
    ]],
    ['開かれし紺碧の砂箱','大型',[
        {item:'アラバマ',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'ボルチモア',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'バーミンガム',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'エールウィン',k_rare:'R',weight:5,k_bikou:'先/掘'}
    ]],
    ['2019年7月、潜水艦','特型',[
        {item:'U101',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'伊168',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'U522',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'伊25',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'伊56',k_rare:'SR',weight:2.5,k_bikou:'先'},
    ]],
    ['光と影のアイリス（復刻）','大型',[
        {item:'ル・マラン',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'ジャン・バール',k_rare:'SSR',weight:1.8,k_bikou:'復'},
        {item:'マサチューセッツ',k_rare:'SSR',weight:1.8,k_bikou:'復'},
        {item:'ルピニャート',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'ダンケルク',k_rare:'SR',weight:2.5,k_bikou:'復'},
        {item:'シュルクーフ',k_rare:'SR',weight:2.5,k_bikou:'復'},
        {item:'フォルバン',k_rare:'R',weight:5,k_bikou:'復'},
    ]],
    ['2019年5月30日、リトル','小型',[
        {item:'リトル・クリーブランド',k_rare:'SR',weight:2.5,k_bikou:'常'},
        {item:'リトル・ヘレナ',k_rare:'SR',weight:2.5,k_bikou:'常'},
    ]],
    ['黒鉄の楽章、誓いの海','大型',[
        {item:'ビスマルク',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'キングジョージ5世',k_rare:'SSR',weight:0.5,k_bikou:'交'},
        {item:'U-556',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'Z36',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'U-73',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'エコー',k_rare:'R',weight:5,k_bikou:'先/掘'},
    ]],
    ['キズナアイ×アズールレーン','大型',[
        {item:'キズナアイ・エレガント',k_rare:'SSR',weight:0.5,k_bikou:'交/？'},
        {item:'キズナアイ・スーパーゲーマー',k_rare:'SSR',weight:2,k_bikou:'？'},
        {item:'キズナアイ・アニバーサリー',k_rare:'SSR',weight:2,k_bikou:'？'},
    ]],
    ['2019年4月26日、ちゃんズ','特型',[
        {item:'比叡ちゃん',k_rare:'SSR',weight:2.5,k_bikou:'先'},
        {item:'赤城ちゃん',k_rare:'SSR',weight:2.5,k_bikou:'先'},
        {item:'ツェッペリンちゃん',k_rare:'SSR',weight:2.5,k_bikou:'先'},
    ]],
    ['軍神の帰還（復刻）','大型',[
        {item:'三笠',k_rare:'SSR',weight:2,k_bikou:'復'},
        {item:'比叡',k_rare:'SR',weight:2.5,k_bikou:'復'},
        {item:'浜風',k_rare:'R',weight:5,k_bikou:'復'},
        {item:'黒潮',k_rare:'R',weight:5,k_bikou:'復'},
        {item:'親潮',k_rare:'R',weight:5,k_bikou:'復'}
    ]],
    ['墨染まりし鋼の桜（復刻）','大型',[
        {item:'伊13',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'長門',k_rare:'SSR',weight:2,k_bikou:'復'},
        {item:'江風',k_rare:'SSR',weight:1.8,k_bikou:'復/掘'},
        {item:'鈴谷',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'宵月',k_rare:'SR',weight:2.5,k_bikou:'復'},
        {item:'春月',k_rare:'SR',weight:2.5,k_bikou:'復'},
        {item:'文月',k_rare:'R',weight:5,k_bikou:'復'},
        {item:'朝潮',k_rare:'R',weight:5,k_bikou:'復'},
    ]],
    ['輝ける峡湾の星','小型',[
        {item:'ハーディ',k_rare:'SR',weight:1.4,k_bikou:'先'},
        {item:'Z2',k_rare:'SR',weight:1.4,k_bikou:'先/掘'},
    ]],
    ['特別演習  超空強襲波','特型',[
        {item:'シャングリラ',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'エセックス',k_rare:'SSR',weight:1.8,k_bikou:'復'},
    ]],
    ['正月イベ','小型',[
        {item:'マラニー',k_rare:'SR',weight:1.5,k_bikou:'先'},
        {item:'チェイサー',k_rare:'SR',weight:1.5,k_bikou:'先'},
        {item:'長春',k_rare:'SR',weight:1.5,k_bikou:'復'},
        {item:'太源',k_rare:'SR',weight:1.5,k_bikou:'復'},
        {item:'キンバリー',k_rare:'R',weight:3.5,k_bikou:'先'},
        {item:'キュラソー',k_rare:'R',weight:3.5,k_bikou:'先'},
        {item:'カーリュー',k_rare:'R',weight:3.5,k_bikou:'先'}
    ]],
    ['凛冽なりし冬の王冠（復刻）','大型',[
        {item:'シリアス',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'ヴィクトリアス',k_rare:'SSR',weight:2,k_bikou:'復'},
        {item:'シェフィールド',k_rare:'SR',weight:2.5,k_bikou:'復'},
        {item:'マッチレス',k_rare:'SR',weight:2.5,k_bikou:'復'},
        {item:'ジャマイカ',k_rare:'R',weight:5,k_bikou:'復/掘'},
    ]],
    ['縹映る深緋の残響','大型',[
        {item:'天城',k_rare:'SSR',weight:2,k_bikou:'先'},
        {item:'加賀(戦艦)',k_rare:'SSR',weight:0.5,k_bikou:'交/掘'},
        {item:'足柄',k_rare:'SR',weight:2.5,k_bikou:'先'},
        {item:'旗風',k_rare:'R',weight:5,k_bikou:'先/掘'},
        {item:'那珂',k_rare:'R',weight:5,k_bikou:'先'},
    ]],
]

var kome01 = [
    ['http://azroyal.bakufu.org/imgpic/face_icon/ayanami.png','「よくわからないですけど……ちょっと嬉しい、です」','綾波'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/akagi.png','「ふふふ……赤城、いつでも準備万端ですわ」','赤城'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/akagi.png','「うふふふ…盛り上がってきたわ～」','赤城'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/akasi.png','「まいどありだにゃ～」','明石'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/gura-futuxextuperinn.png','「さぁ条件が全て揃った。では建造するとしよう......」','にくすべ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/San_Diego_1.png','「おめディエゴ！」','サンディエゴ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ayanami.png','「リアルは神ゲー…だったです？」','綾波'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Javelin.png','「ジャベリン、全力でイキま～す、です！」','ジャベリン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Javelin.png','「とってもラッキーです！」','ジャベリン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ruffy.png','「ラフィー…ガチャ…好き」','ラフィー'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ruffy.png','「この程度、あの時と比べて全然…」','ラフィー'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Prinz_Eugen.png','「指揮官～もう一回♪もう二回♪もっと回しちゃえ～」','オイゲン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ni-mi.png','「こうなったら仕方ありません、実力行使です！！」','ニーミ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Javelin.png','「ジャベリンは運がとってもいいんですよ！」','ジャベリン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ni-mi.png','「指揮官、ちゃんとコンプしてくださいね！」','ニーミ'],
  ];
 var kome02 = [
    ['http://azroyal.bakufu.org/imgpic/face_icon/akagi.png','「うふふ…指揮官様、絶対に、絶対に、絶対に絶対に絶対に…この建造から逃げないでくださいね…」','赤城'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/akasi.png','「ん…？これは？課金が必要そうだにゃ…」','明石'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ayanami.png','「少しだけ悲しい…です」','綾波'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/gura-futuxextuperinn.png','「憎んでいる。すべてを。」','にくすべ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ruffy.png','「指揮官、がっかりした？（ツンツン」','ラフィー'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/San_Diego_1.png','「早くお金を出して！！このままじゃ「おりゅ？」になっちゃうよ！！」','サンディエゴ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/enterprise.png','「終わりだ・・・（絶望）」','エンタープライズ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Saratoga.png','「うわぁ！大ピンチ！」','サラトガ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ayanami.png','「新キャラのためなら、「課金」してもいい……です」','綾波'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ayanami.png','「ガチャは嫌いではないけど好きじゃないです。」','綾波'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Javelin.png','「コンプしたいなら、回転数をもーっと増やさないとダメですよ？」','ジャベリン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ruffy.png','「指揮官、お金貸して、回す。」','ラフィー'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ruffy.png','「自己リミッター解除……」','ラフィー'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ni-mi.png','「…無理だよ。常識的に考えて」','ニーミ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ni-mi.png','「うぅ…だめ、まだ泣いちゃ…！」','ニーミ']
  ];
 var kome03 = [
    ['http://azroyal.bakufu.org/imgpic/face_icon/Saratoga.png','「サラトガちゃん、あなた(のサイフ)がダイスキだよ～♪」','サラトガ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/unicorn.png','「ぐーぐるぷれい…？ユニコーン、お兄ちゃんが何言ってるかわかんない…」','ユニコーン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Saratoga.png','「ナントカナルゼッタイダイジョウブノープロブレム！」','サラトガ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/enterprise.png','「指揮官、教えてくれ。私はあと何回建造すればいい？」','エンタープライズ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/San_Diego_1.png','「よくわかんないけど、頑張ればきっとダイジョウブ！！」','サンディエゴ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Prinz_Eugen.png','「この程度で満足かしら？」','オイゲン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/akasi.png','「指揮官(のサイフ)ダイスキだにゃ！」','明石'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ni-mi.png','「回転数は大切ですよ。「出るまで回せば100％」と偉人の方が仰っていました……」','ニーミ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ayanami.png','「大丈夫です、指揮官…綾波を信じて――」','綾波'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Prinz_Eugen.png','「この程度じゃ足りないわ。もっと、もっとだ……！」','オイゲン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Javelin.png','「単発で当てちゃうよ！…えい！」','ジャベリン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/Javelin.png','「ナルホド　ナルホド　ソウイウ仕組ミナンデスネ」','ジャベリン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ruffy.png','「うん…二度寝しよう……」','ラフィー'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/unicorn.png','「くれじっとかーど？ないよ？そんなの…」','ユニコーン'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/ni-mi.png','「対策を考えないと……」','ニーミ'],
    ['http://azroyal.bakufu.org/imgpic/face_icon/gura-futuxextuperinn.png','「神への祈りは果たして意味があるか？神が応えてくれるか？Nein(違う)、神は慈悲がないからこそ神になりえるのだ」','にくすべ'],
  ];

var table_main = '<table border="1" id="area_table" style="border-collapse: collapse;width:100%;">'+
'<tr class="tr_number" style="text-align: center;font-size: 0.9em;">'+
    '<th style="width:2em;">除</th>'+
    '<th>艦船名</th>'+
    '<th style="width:2.5em;">レア</th>'+
    '<th style="width:3.2em;">排出</th>'+
    '<th style="width:3em;">備考</th>'+
'</tr>'+
'</table>';

var table_tr = '<tr class="tr_number"><td><input type="checkbox" class="number_index"></td>'+
'<td></td><td></td><td></td><td></td>'+
'</tr>';

window.addEventListener('DOMContentLoaded', function() {
    picup_set();
})

function getindex() {
    var title = document.getElementById("event_title").value;
    for(var i=0; i<gatya_title.length; i++) {
        if(title==gatya_title[i][0]){
            return i;
        } 
    }
}

var gatya_index = '';
function picup_set(){
    var pickupdeta = document.getElementById("pickupdeta");
    pickupdeta.textContent = "";
    gatya_index = getindex();
    pickupdeta.insertAdjacentHTML('afterbegin',table_main);
    for(p=0; p<gatya_title[gatya_index][2].length; p++){
        document.getElementsByClassName("tr_number")[p].insertAdjacentHTML('afterend',table_tr);
        document.getElementsByClassName("tr_number")[p+1].getElementsByTagName("td")[1].textContent = gatya_title[gatya_index][2][p].item;
        document.getElementsByClassName("tr_number")[p+1].getElementsByTagName("td")[2].textContent = gatya_title[gatya_index][2][p].k_rare;
        document.getElementsByClassName("tr_number")[p+1].getElementsByTagName("td")[3].textContent = gatya_title[gatya_index][2][p].weight+'%';
        document.getElementsByClassName("tr_number")[p+1].getElementsByTagName("td")[4].textContent = gatya_title[gatya_index][2][p].k_bikou;
    }
}

// 値と重みのObject配列[{item: value, weight}, ...]
const ProbabilisticChoice = (list) => {
    const totalWeight = list.reduce((p, c) => {
      return { weight: p.weight + c.weight }
    }).weight

    return {
      pick () {
        const r = Math.random() * totalWeight;
        let s = 0.0;
        for (const l of list) {
          s += l.weight
          if (r < s) { return l.item }
        }
      }
    }
  }

var types ={};
var checkset = [];
function hairetuset(){
    checkset = [];
    for(var c=0; c<document.getElementsByClassName("number_index").length; c++){
        if(document.getElementsByClassName("number_index")[c].checked){
            ;
        }else{
            checkset.push(gatya_title[gatya_index][2][c]);
        }
    }

    if(gatya_title[gatya_index][1]=='小型'){
        var SSR = {item:'SSR',weight:7},SR={item:'SR',weight:12},R={item:'R',weight:30},N={item:'N',weight:55};

    }else{
        var SSR = {item:'SSR',weight:7},SR={item:'SR',weight:12},R={item:'R',weight:51},N={item:'N',weight:30};
    }

    for(var b=0; b<checkset.length; b++){
        switch(checkset[b].k_rare){
            case 'SSR':
                SSR.weight-=checkset[b].weight;
            break;
            case 'SR':
                SR.weight-=checkset[b].weight;
            break;
            case 'R':
                R.weight-=checkset[b].weight;
            break;
            case 'N':
                N.weight-=checkset[b].weight;
            break;
        }
    }
    checkset.push(SSR,SR,R,N);
}

var txtdeta = "";
var txtdeta_b ="";
function resultset(types_deta){
    txtdeta = "";tweet_deta2 ="";
    for(var txt=0; txt<checkset.length-4; txt++){
        txtdeta += checkset[txt].item+':'+types_deta[checkset[txt].item]+'<br>';
        tweet_deta2 +=  checkset[txt].item+':'+types_deta[checkset[txt].item]+'\n';
    }
    txtdeta_b ="";tweet_deta3 ="";
    for(var txt=0; txt<4; txt++){
        txtdeta_b += '['+checkset[checkset.length-4+txt].item+':'+types_deta[checkset[checkset.length-4+txt].item]+']';
        tweet_deta3 += '['+checkset[checkset.length-4+txt].item+':'+types_deta[checkset[checkset.length-4+txt].item]+']';
    }
}
var days_text = "";
function set_start(){
    hairetuset();
    bloodLists = ProbabilisticChoice(checkset);
    types = {};
    for(var d=0; d<checkset.length; d++){
        types[checkset[d].item] = 0;
    }

    for (var i = 0; i < document.getElementById("gatya_set").value*1; i++) {
        var blood = bloodLists.pick();
        types[blood] += 1;

    }
    var hantei = 0
    for(var d=0; d<checkset.length-4; d++){
        if(types[checkset[d].item]==0){
        ;
        }else{
        hantei++;
        }
    }
    if(hantei==checkset.length-4){
        days_text = document.getElementById("gatya_set").value*1+'連建造した結果'+'<br>'+'ピックアップコンプリート！';
        tweet_deta1 = document.getElementById("gatya_set").value*1+'連建造した結果'+'\n'+'ピックアップコンプリート！';
        img_pic(1);
    }else{
        days_text = document.getElementById("gatya_set").value*1+'連建造した結果'+'<br>'+'そろいませんでした…';
        tweet_deta1 =  document.getElementById("gatya_set").value*1+'連建造した結果'+'\n'+'そろいませんでした…';
        img_pic(2);
    }
    document.getElementById("result_text").textContent = "";document.getElementById("result_area").textContent ="";
    document.getElementById("result_text").insertAdjacentHTML('afterbegin',days_text);
    resultset(types);
    document.getElementById("result_area").insertAdjacentHTML('afterbegin',txtdeta+'ほか:'+txtdeta_b);
    twion();
}

function all_comp(){
    hairetuset();
    bloodLists = ProbabilisticChoice(checkset);
    types = {};
    for(var d=0; d<checkset.length; d++){
        types[checkset[d].item] = 0;
    }
    for (var i = 0; i <10000; i++) {
        var blood = bloodLists.pick();
        types[blood] += 1;

        var hantei = 0
        for(var d=0; d<checkset.length-4; d++){
            if(types[checkset[d].item]==0){
            ;
            }else{
            hantei++;
            }
        }
        if(hantei==checkset.length-4){
          i++;
            break;
        }
    }
    days_text = '出るまで建造した結果'+'<br>'+'建造<strong>'+i+'</strong>回目でコンプリート！';
    tweet_deta1 = '出るまで建造した結果'+'\n'+'建造'+i+'回目でコンプリート！';
    document.getElementById("result_text").textContent = "";document.getElementById("result_area").textContent ="";
    document.getElementById("result_text").insertAdjacentHTML('afterbegin',days_text);
    resultset(types);
    document.getElementById("result_area").insertAdjacentHTML('afterbegin',txtdeta+'ほか:'+txtdeta_b);
    twion();
    img_pic(1);
}

function onedays(){
    hairetuset();
    // 重み付けリスト
    bloodLists = ProbabilisticChoice(checkset);
    // 確認用オブジェクト
    types = {};
    for(var d=0; d<checkset.length; d++){
        types[checkset[d].item] = 0;
    }
    for(var days=0; days<document.getElementById("days_set").value*1; days++){
        for (var i = 0; i <3; i++) {
            // 値の取得
            var blood = bloodLists.pick();
            types[blood] += 1;
        }
        //揃ったor揃わない
        var hantei = 0
        for(var d=0; d<checkset.length-4; d++){
            if(types[checkset[d].item]==0){
            ;
            }else{
            hantei++;
            }
        }
        if(hantei==checkset.length-4){
          days++;
            days_text = document.getElementById("days_set").value*1+'日間、毎日3回建造した結果'+'<br>'+days+'日目でコンプリート！';
            tweet_deta1 = document.getElementById("days_set").value*1+'日間、毎日3回建造した結果'+'\n'+days+'日目でコンプリート！';
            img_pic(1);
            break;
        }else{
            days_text = document.getElementById("days_set").value*1+'日間、毎日3回建造した結果'+'<br>'+'そろいませんでした…';
            tweet_deta1 = document.getElementById("days_set").value*1+'日間、毎日3回建造した結果'+'\n'+'そろいませんでした…';
            img_pic(3);
        }
    }
    document.getElementById("result_text").textContent = "";document.getElementById("result_area").textContent ="";
    document.getElementById("result_text").insertAdjacentHTML('afterbegin',days_text);
    resultset(types);
    document.getElementById("result_area").insertAdjacentHTML('afterbegin',txtdeta+'ほか:'+txtdeta_b);
    twion();
}

function simulation(){
	/**
 * オブジェクト同士を加算
 * @return Object 左辺と右辺を加算して作られた新しいオブジェクト
 */
Object.prototype.plus = function(arg){
	var ret = {};
	for(key in this){
		ret[key] = this[key];
	}
	for(key in arg){
		if(key in ret){
			if(typeof arg[key] === 'function')continue;
			ret[key] = ret[key] + arg[key];
		}
		else{
			ret[key] = arg[key];
		}
	}
	return ret;
};

    hairetuset();
    bloodLists = ProbabilisticChoice(checkset);
    var bunsi = 0;
    var sum_types = "";
    for(var sen=0; sen<1000; sen++){
        types = {};
        for(var d=0; d<checkset.length; d++){
            types[checkset[d].item] = 0;
        }
        for (var i = 0; i < document.getElementById("gatya_set").value*1; i++) {
            var blood = bloodLists.pick();
            types[blood] += 1;
        }
        var hantei = 0;
        for(var d=0; d<checkset.length-4; d++){
            hantei = types[checkset[d].item]==0 ? hantei+=0 : hantei+=1;
        }
        bunsi = hantei==checkset.length-4 ? bunsi+=1 : bunsi+=0;
        sum_types = sum_types.plus(types);
    }
    days_text = document.getElementById("gatya_set").value*1+'連建造×1000セットした結果'+'<br>'+(Math.floor(bunsi)/10)+'％の確率でコンプリート！';
    tweet_deta1 = document.getElementById("gatya_set").value*1+'連建造×1000セットした結果'+'\n'+(Math.floor(bunsi)/10)+'％の確率でコンプリート！';
    document.getElementById("result_text").textContent = "";document.getElementById("result_area").textContent ="";
    document.getElementById("result_text").insertAdjacentHTML('afterbegin',days_text);
    txtdeta = "";tweet_deta2 = "";
    for(var txt=0; txt<checkset.length-4; txt++){
        txtdeta += checkset[txt].item+':'+sum_types[checkset[txt].item]/1000+'<br>';
        tweet_deta2 += checkset[txt].item+':'+sum_types[checkset[txt].item]/1000+'\n';
    }
    txtdeta_b ="";tweet_deta3 = "";
    for(var txt=0; txt<4; txt++){
        txtdeta_b += '['+checkset[checkset.length-4+txt].item+':'+sum_types[checkset[checkset.length-4+txt].item]/1000+']';
        tweet_deta3 += '['+checkset[checkset.length-4+txt].item+':'+sum_types[checkset[checkset.length-4+txt].item]/1000+']';
    }
    document.getElementById("result_area").insertAdjacentHTML('afterbegin',txtdeta+'ほか:'+txtdeta_b);
    twion();
    img_pic(1);
}
var tweet_deta1 ="";
var tweet_deta2 ="";
var tweet_deta3 ="";

function img_pic(root){
    switch(root){
        case 1:
            var character = kome01[Math.floor(Math.random() * kome01.length)]
        break;
        case 2:
            var character = kome02[Math.floor(Math.random() * kome02.length)]
        break;
        case 3:
            var character = kome03[Math.floor(Math.random() * kome03.length)]
        break;
    }
    document.getElementsByClassName("pic_area")[0].src =character[0];
    document.getElementsByClassName("pic_area")[1].textContent =character[1];
}

function img_pic(root){
    switch(root){
        case 1:
            var character = kome01[Math.floor(Math.random() * kome01.length)]
        break;
        case 2:
            var character = kome02[Math.floor(Math.random() * kome02.length)]
        break;
        case 3:
            var character = kome03[Math.floor(Math.random() * kome03.length)]
        break;
    }
    document.getElementsByClassName("pic_area")[0].src =character[0];
    document.getElementsByClassName("pic_area")[1].textContent =character[1];
}

var shareUrl = "https://az-royalojisann.hatenablog.com/entry/az-matching_tool";
var targetId = "tweet1";
//var message = '#アズレン建造チャレンジ'+'\n'+tweetdeta1+'\n'+tweetdeta2+'ほか:'+tweetdeta3;
//var hashtag = "アズールレーン";

// Twitterの初期化
var d = document;
var s = 'script';
var id = 'twitter-wjs';
var js, fjs = d.getElementsByTagName(s)[0];
if (!d.getElementById(id)) {
 js = d.createElement(s);
 js.id = id;
 js.src = 'https://platform.twitter.com/widgets.js';
 fjs.parentNode.insertBefore(js, fjs);
}
function twion(){
// twttrの初期化(platform.twitter.com/widgets.jsの完了)が未だなら待つ。
function callAfterTwitterInitialization(callback){
if(typeof twttr !== "undefined"){
 callback();
} else {
 setTimeout(function(){
     callAfterTwitterInitialization(callback);
 }, 100);
}
}
 
// twttrが使えるようになったらシェアボタンを作る。
callAfterTwitterInitialization(function(){
$('#' + targetId).empty();
twttr.widgets.createShareButton(
 shareUrl,
 document.getElementById(targetId),
 {
   count: 'none',
   text: "#アズレン建造チャレンジ"+"\n"+tweet_deta1+"\n"+tweet_deta2+"ほか:"+tweet_deta3+"\n"+"アズールレーン"+"\n",
   size: "large",
   hashtags: "",
 });
});
}

function retry(){
    document.getElementById("az_content").style.display="block";
    document.getElementById("result_area").style.display="none";
    toi_n = 0;
    kaitou = [];
    hantei = [];
    toiset();
}
